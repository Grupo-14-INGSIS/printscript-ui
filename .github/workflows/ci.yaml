deploy-vm1:
  needs: build
  runs-on: ubuntu-latest

  steps:
    - name: Deploy to VM1
      uses: appleboy/ssh-action@v1.0.3  # ‚Üê CAMBIAR de v1.0.0 a v1.0.3
      with:
        host: ${{ secrets.VM1_HOST }}
        username: ${{ secrets.VM1_USER }}
        key: ${{ secrets.VM_SSH_KEY }}
        script: |
          echo "üöÄ Deploying to VM1..."
          
          # Login to GitHub Container Registry
          echo ${{ secrets.GITHUB_TOKEN }} | docker login ghcr.io -u ${{ github.actor }} --password-stdin
          
          # Pull latest image
          docker pull ghcr.io/${{ github.repository_owner }}/printscript-ui:latest
          
          # Stop and remove old container
          docker stop printscript-ui || true
          docker rm printscript-ui || true
          
          # Run new container
          docker run -d \
            --name printscript-ui \
            --restart unless-stopped \
            -p 80:80 \
            ghcr.io/${{ github.repository_owner }}/printscript-ui:latest
          
          # Clean up
          docker image prune -af
          
          echo "‚úÖ VM1 deployment complete"

deploy-vm2:
  needs: build
  runs-on: ubuntu-latest

  steps:
    - name: Deploy to VM2
      uses: appleboy/ssh-action@v1.0.3  # ‚Üê CAMBIAR tambi√©n aqu√≠
      with:
        host: ${{ secrets.VM2_HOST }}
        username: ${{ secrets.VM2_USER }}
        key: ${{ secrets.VM_SSH_KEY }}
        script: |
          echo "üöÄ Deploying to VM2..."
          
          # Login to GitHub Container Registry
          echo ${{ secrets.GITHUB_TOKEN }} | docker login ghcr.io -u ${{ github.actor }} --password-stdin
          
          # Pull latest image
          docker pull ghcr.io/${{ github.repository_owner }}/printscript-ui:latest
          
          # Stop and remove old container
          docker stop printscript-ui || true
          docker rm printscript-ui || true
          
          # Run new container
          docker run -d \
            --name printscript-ui \
            --restart unless-stopped \
            -p 80:80 \
            ghcr.io/${{ github.repository_owner }}/printscript-ui:latest
          
          # Clean up
          docker image prune -af
          
          echo "‚úÖ VM2 deployment complete"